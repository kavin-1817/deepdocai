<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script>
    let recognition;
    let isRecording = false;

    function startRecognition() {
      if (!('webkitSpeechRecognition' in window)) {
        Streamlit.setComponentValue({ text: "Speech recognition not supported in this browser.", error: true });
        return;
      }

      recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US'; // Adjust language as needed

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        Streamlit.setComponentValue({ text: transcript, error: false });
        stopRecognition();
      };

      recognition.onerror = function(event) {
        Streamlit.setComponentValue({ text: "Error: " + event.error, error: true });
        stopRecognition();
      };

      recognition.onend = function() {
        isRecording = false;
        document.getElementById('micButton').textContent = 'ðŸŽ¤ Voice Input';
      };

      recognition.start();
      isRecording = true;
      document.getElementById('micButton').textContent = 'ðŸŽ¤ Listening...';
    }

    function stopRecognition() {
      if (recognition && isRecording) {
        recognition.stop();
        isRecording = false;
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('micButton').addEventListener('click', function() {
        if (!isRecording) {
          startRecognition();
        } else {
          stopRecognition();
        }
      });
    });

    Streamlit.onReady(function() {
      // Component is ready
    });
  </script>
</head>
<body>
  <button id="micButton" style="font-size: 16px; padding: 10px;">ðŸŽ¤ Voice Input</button>
</body>
</html>
